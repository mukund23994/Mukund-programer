<!DOCTYPE html>
<html>
<head>
  <title>Checkout</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #aaa;
      border-radius: 6px;
    }
    button {
      background: green;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h2>Checkout</h2>

<form id="checkoutForm">
  <label>Name:</label>
  <input type="text" id="name" required>

  <label>Phone:</label>
  <input type="text" id="phone" required>

  <label>Address:</label>
  <textarea id="address" required></textarea>

  <button type="submit">Place Order</button>
</form>


<!-- Firebase v8 (Admin page ke saath match karta hai) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// SAME CONFIG AS YOUR ADMIN PAGE
const firebaseConfig = {
  apiKey: "AIzaSyBu2IUZ2RpB_pv0zA5nXqL7ur0uKZc8btE",
  authDomain: "indian-sellar-marketplac-d6395.firebaseapp.com",
  databaseURL: "https://indian-sellar-marketplac-d6395-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "indian-sellar-marketplac-d6395",
  storageBucket: "indian-sellar-marketplac-d6395.firebasestorage.app",
  messagingSenderId: "35436518492",
  appId: "1:35436518492:web:24c75eb5b85cd8f7d71a99"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---- CART READING FUNCTION ----
function getCartItems() {
  try {
    let cart = localStorage.getItem("cart") || localStorage.getItem("cartItems");

    if (!cart) {
      let item = localStorage.getItem("selectedProduct");
      if (item) return [{ name: item, price: 0, quantity: 1 }];
      return [];
    }

    let data = JSON.parse(cart);
    return Array.isArray(data) ? data : [];
  } catch {
    return [];
  }
}

// ---- SUBMIT ORDER ----
document.getElementById("checkoutForm").addEventListener("submit", function(e) {
  e.preventDefault();

  let order = {
    customerName: document.getElementById("name").value,
    phone: document.getElementById("phone").value,
    address: document.getElementById("address").value,
    cartItems: getCartItems(),
    time: new Date().toLocaleString()
  };

  db.ref("orders").push(order, (err) => {
    if (err) {
      alert("Error placing order!");
      console.log(err);
    } else {
      alert("Order placed successfully!");
      window.location.href = "orders.html";  // ADMIN PAGE
    }
  });
});
</script>

</body>
</html>
